@model NexenHub.ViewModels.MachineTagnameViewModel
@{
}

<div class="card h-100">
    <div class="card-body p-0">
        <div class="row">
            <div class="col-auto p-3">

                <div class="row">
                    <div class="col">
                        <h5>@Model.MachineInfo.Name</h5>
                    </div>
                </div>
            
                <div class="row">
                    <div class="col">
                        <span class="text-muted">@Model.MachineInfo.WC_ID / @Model.MachineInfo.PROC_ID / @Model.MachineInfo.EQ_ID</span>
                    </div>
                </div>
            
            </div>

            <div id="@Html.Raw(Model.MachineInfo.EQ_ID + "_downTimeFrame")" 
            class="col-auto p-3 border-start rounded-end">
                <div class="d-flex h-100 align-items-center">
                    <h5 id="@Html.Raw(Model.MachineInfo.EQ_ID + "_downTimeMsg")" class="text-uppercase"></h5>
                    </div>
            </div>
        </div>
    </div>
</div>

<script type="text/javascript">

document.addEventListener('readystatechange', event => {
        switch (document.readyState) {
            case "loading":
                break;
            case "interactive":
                refreshMachineInfo();
                break;
            case "complete":
                setInterval(refreshMachineInfo, 10000);
                break;
        }
    });


    async function refreshMachineInfo(){
        await machineDowntime(@Model.MachineInfo.EQ_ID);
    }

    async function machineDowntime(eqid)
    {
        return await fetch(window.location.origin + '/api/prod/actDowntime/' + eqid)
            .then(response => response.json())
            .then(data => 
            {
                var msg = 'Running';
                var msgStyle = 'bg-github-green';
                var msgcolor = 'text-white';

                var msgElement = document.getElementById('@Html.Raw(Model.MachineInfo.EQ_ID + "_downTimeMsg")');
                var frameElement = document.getElementById('@Html.Raw(Model.MachineInfo.EQ_ID + "_downTimeFrame")');

                frameElement.classList.remove('bg-github-green', 'bg-warning', 'bg-github-red');
                msgElement.classList.remove('text-white','text-black');

                if (data['Code'] != '')
                {
                    msg = data['Description'];

                    if (data['Code'] == 'N016')
                    {
                        msgStyle = 'bg-warning';
                        msgcolor = 'text-black';
                    }
                    else
                    {
                        msgStyle = 'bg-github-red';
                    }
                }

                msgElement.innerHTML = msg;
                frameElement.classList.add(msgStyle);
                msgElement.classList.add(msgcolor);
            });
    }
    
</script>
