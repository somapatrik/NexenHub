@model NexenHub.ViewModels.WoLineViewModel
@{
}

<div id="@Html.Raw(Model.EQ_ID + "_woLineRow")" class="list-group-flush p-0 h-100">

</div>

<div id="woListCode" style="position:absolute;display:none;margin:0;padding:0;top:0;left:0">

    <div class="list-group-item border-secondary {{wocardstyle}}">
           <div class="d-flex">
                <div class="text-truncate">{{itemname}}</div>
                <div></div>
           </div>
            <div class="d-flex">
                <div class="flex-grow-1">{{workorder}}</div>
                <div>{{status}}</div>
            </div>
       </div>

</div>

<script type="text/javascript">

document.addEventListener('readystatechange', event => {
        switch (document.readyState) {
            case "loading":
                break;
            case "interactive":
                getWoList();
                break;
            case "complete":
                setInterval(getWoList, 10000);
                break;
        }
    });

async function getWoList()
{
        return await fetch(window.location.origin + '/api/cockpit/wolist/' + @Model.EQ_ID)
            .then(response => response.json())
            .then(data => displayWoList(data));
}

async function displayWoList(data)
{
    var code = document.getElementById('woListCode').innerHTML;
    var row = document.getElementById(@Html.Raw("'" + Model.EQ_ID + "_woLineRow'"));

    row.innerHTML= '';

        data.Waiting.forEach(waiting => {
            var fCode = '';

            if (waiting['TEST_YN'] == 'Y')
                fCode = code.replace('{{wocardstyle}}', 'bg-transparent text-light');
            else
                fCode = code.replace('{{wocardstyle}}', 'bg-transparent text-light');

             fCode = fCode.replace('{{workorder}}', waiting['WO_NO']);
             fCode = fCode.replace('{{itemname}}', waiting['ITEM_NAME']);
             fCode = fCode.replace('{{prodtype}}', waiting['PROD_TYPE']);
            fCode = fCode.replace('{{status}}', 'Waiting');
            
        row.innerHTML += fCode;
    });


    data.Started.forEach(started => {

            var fCode = '';

            if (started['TEST_YN'] == 'Y')
                fCode = code.replace('{{wocardstyle}}', 'bg-warning text-black');
            else
                fCode = code.replace('{{wocardstyle}}', 'bg-github-green text-white');

            fCode = fCode.replace('{{workorder}}', started['WO_NO']);
            fCode = fCode.replace('{{itemname}}', started['ITEM_NAME']);
            fCode = fCode.replace('{{prodtype}}', started['PROD_TYPE']);
            fCode = fCode.replace('{{status}}', 'Active');

            row.innerHTML += fCode;
    });

        data.Finished.forEach(finished => {
            var fCode = '';

            if (finished['TEST_YN'] == 'Y')
                fCode = code.replace('{{wocardstyle}}', 'bg-transparent text-light text-muted');
            else
                fCode = code.replace('{{wocardstyle}}', 'bg-transparent text-muted');


            fCode = fCode.replace('{{workorder}}', finished['WO_NO']);
            fCode = fCode.replace('{{itemname}}', finished['ITEM_NAME']);
            fCode = fCode.replace('{{prodtype}}', finished['PROD_TYPE']);
            fCode = fCode.replace('{{status}}', 'Finished');
            
        row.innerHTML += fCode;
    });

}

</script>